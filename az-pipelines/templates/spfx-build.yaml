parameters:
  - name: nodeVersion
    type: string
    default: "12"

  - name: artifactName
    type: string
    default: "drop"

steps:
  - task: NodeTool@0
    displayName: "use node ${{ parameters.nodeVersion }}.x"
    inputs:
      versionSpec: "${{ parameters.nodeVersion }}".x
    
  - task: CmdLine@2
    displayName: npm install
    inputs:
          script: "npm install"

  - task: gulp@1
    displayName: "gulp bundel"
    inputs:
      gulpFile: "gulpfile.js"
      targets: "bundle"
      arguments: "--ship"
      enableCodeCoverage: false

  - task: gulp@1
    displayName: "gulp package solution"
    inputs:
      gulpFile: "gulpfile.js"
      targets: "package-solution"
      arguments: "--ship"

  - task: CopyFiles@2
    displayName: "Copy Files to: $(build.artifactstagingdirectory)/${{ parameters.artifactName }}"
    inputs:
      Contents: "sharepoint/solution/*.sppkg"
      TargetFolder: "$(build.artifactstagingdirectory)/${{ parameters.artifactName }}"

  - task: PublishBuildArtifacts@1
    displayName: "Publish artifacts: ${{ parameters.artifactName }}"
    inputs:
        PathtoPublish: "$(Build.ArtifactStagingDirectory)/${{ parameters.artifactName }}"    